{"version":3,"sources":["scripts/views/detail/index.js","scripts/components/Head/index.js","scripts/mobx/shopcar.js"],"names":["Detail","connect","state","user","get","props","onChange","val","setState","count","buyNow","history","push","addToCar","getCarList","shopcar","axios","post","goodInfo","good","goodId","then","res","hide","console","log","match","params","this","data","result","location","className","title","URLSearchParams","search","slice","show","size","Header","type","text","thumb","extra","price","Body","style","width","height","src","img","alt","Footer","content","minWidth","showNumber","min","value","onClick","Component","Item","Head","goback","dispatch","changeTab","localStorage","oldTab","go","gotoSearch","login","scan","mode","icon","onLeftClick","rightContent","key","marginRight","Pop","myImg","handleVisibleChange","visible","onSelect","obj","showActionSheet","BUTTONS","showActionSheetWithOptions","options","cancelButtonIndex","length","destructiveButtonIndex","message","maskClosable","wrapProps","onTouchStart","e","preventDefault","buttonIndex","mask","overlayClassName","overlayStyle","color","overlay","data-seed","whiteSpace","align","overflow","adjustY","adjustX","offset","onVisibleChange","padding","display","alignItems","ShopCar","num","carList","forEach","item","checked","total","flag","observable","action","map","parseInt","goodIdList","filter","computed"],"mappings":"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","file":"static/js/21.c70fe6db.chunk.js","sourcesContent":["\r\n\r\nimport \"./index.scss\"\r\nimport Head  from \"~/components/Head\";\r\nimport {axios} from \"&\"\r\nimport {WingBlank,Card,WhiteSpace,Stepper,Button} from \"antd-mobile\";\r\nimport {connect} from \"react-redux\"\r\nimport {history} from \"&/history\";\r\nimport shopcar from \"~/mobx/shopcar\";\r\nimport {Toast} from \"antd-mobile\"\r\n@connect(\r\n    state=>({\r\n        user:state.get(\"user\")\r\n    })\r\n)\r\nexport default class Detail extends Component{\r\n\r\n    constructor(props){\r\n        super(props);\r\n        console.log(props);\r\n        this.state = {\r\n            count:1,\r\n            good:{},\r\n            goodId:props.match.params.goodId\r\n        }\r\n    }\r\n\r\n    componentDidMount(){\r\n        axios.get(\"/vue/getGoodDetail\",{\r\n            params:{\r\n                goodId:this.state.goodId\r\n            }\r\n        }).then(res=>{\r\n            this.setState({\r\n                good:res.data.result\r\n            })\r\n        })\r\n    }\r\n    onChange=(val)=>{\r\n        this.setState({\r\n            count:val\r\n        })\r\n    }\r\n    buyNow=()=>{\r\n        history.push(\"/index/cart\");\r\n    }\r\n\r\n    addToCar=()=>{\r\n        const {\r\n            getCarList\r\n        }  =  shopcar\r\n        axios.post(\"/react/addShopCar\",{\r\n            count:this.state.count,\r\n            goodInfo:this.state.good,\r\n            goodId:this.state.goodId\r\n        }).then(res=>{\r\n            Toast.hide();\r\n            getCarList();\r\n        })\r\n    }\r\n\r\n    render(){\r\n        const {\r\n            location,\r\n            user\r\n        } = this.props;\r\n        const {\r\n            good\r\n        } = this.state;\r\n        return (\r\n            <div className=\"indexview\">\r\n                <Head title={ new URLSearchParams(location.search).get(\"name\").slice(0,10) } show={true} > </Head>\r\n                <WingBlank size=\"lg\">\r\n                    <WhiteSpace size=\"lg\" />\r\n                    <Card>\r\n                    <Card.Header\r\n                        title={good.type&&good.type.text}\r\n                        thumb={user.get('pic')}\r\n                        extra={<span>RMB: ¥  {good.price}</span>}\r\n                    />\r\n                    <Card.Body>\r\n                        <div><img style={{width:\"100%\",height:\"4rem\"}} src={good.img} alt=\"\"/></div>\r\n                    </Card.Body>\r\n                    <Card.Footer content=\"点赞\" extra={<div>收藏</div>} />\r\n                    </Card>\r\n                    <WhiteSpace size=\"lg\" />\r\n                    <div>\r\n                    购买数量:\r\n                    <Stepper\r\n                        style={{ width: '50%', minWidth: '100px' }}\r\n                        showNumber\r\n                        min={1}\r\n                        value={this.state.count}\r\n                        onChange={this.onChange}\r\n                        />\r\n                    </div>\r\n                    <WhiteSpace size=\"lg\" />\r\n                    <Button type=\"warning\" onClick={this.buyNow} > 立即购买 </Button>\r\n                    <WhiteSpace size=\"lg\" />\r\n                    <Button type=\"primary\" onClick={this.addToCar}>加入购物车</Button>\r\n                </WingBlank>\r\n            </div>\r\n        )\r\n    }\r\n}","\r\n\r\nimport \"./index.scss\"\r\n\r\nimport {NavBar,Icon,Popover,ActionSheet} from \"antd-mobile\"\r\nconst Item = Popover.Item;\r\n\r\nimport {history} from \"&/history\";\r\n\r\nimport {bus} from \"&\"\r\n\r\nimport {connect} from \"react-redux\"\r\nimport { changeTab } from \"../../actions\";\r\n\r\n\r\n@connect()\r\nexport default class Head extends Component{\r\n    goback=(show)=>{\r\n        if(show){\r\n            // bus.emit(\"changeTab\",localStorage.oldTab);\r\n            this.props.dispatch(changeTab(localStorage.oldTab))\r\n            history.go(-1);\r\n        }\r\n    }\r\n\r\n    gotoSearch=()=>{\r\n        history.push(\"/search\");\r\n    }\r\n\r\n    render(){\r\n        const {\r\n            show,\r\n            search,\r\n            login,\r\n            scan\r\n        }  = this.props;\r\n        return (\r\n            <NavBar\r\n            mode=\"dark\"\r\n            icon={show&&<Icon type=\"left\" />}\r\n            onLeftClick={ ()=>this.goback(show) }\r\n            rightContent={[\r\n             !search&&<Icon key=\"0\" onClick={this.gotoSearch} type=\"search\" style={{ marginRight: '16px' }} />,\r\n             <Pop key={1} login={login} scan={scan}/>     ,\r\n            ]}\r\n          > {this.props.title }</NavBar>\r\n        )\r\n    }\r\n}\r\n\r\nconst myImg = src => <img src={`https://gw.alipayobjects.com/zos/rmsportal/${src}.svg`} className=\"am-icon am-icon-xs\" alt=\"\" />;\r\nclass Pop extends Component{\r\n    constructor(){\r\n        super();\r\n        this.state = {\r\n            visible:false\r\n        }\r\n    }\r\n    handleVisibleChange=(visible)=>{\r\n        this.setState({\r\n            visible\r\n        })\r\n    }\r\n    onSelect=(obj)=>{\r\n        this.setState({\r\n            visible:false\r\n        });\r\n        console.log(obj);\r\n        const value = obj.props.value;\r\n        if(value==\"scan\"){\r\n            history.push(\"/scan\");\r\n        }else if (value==\"login\"){\r\n            history.push(\"/login\");\r\n        }else {\r\n            this.showActionSheet();\r\n        }\r\n    }\r\n\r\n    showActionSheet = () => {\r\n        const BUTTONS = ['拍摄', '从手机相册选择','删除',\"取消\"];\r\n        ActionSheet.showActionSheetWithOptions({\r\n          options: BUTTONS,\r\n          cancelButtonIndex: BUTTONS.length - 1,\r\n          destructiveButtonIndex: BUTTONS.length - 2,\r\n          // title: 'title',\r\n          message: 'wh1906',\r\n          maskClosable: true,\r\n          'data-seed': 'logId',\r\n          wrapProps:{\r\n            onTouchStart: e => e.preventDefault(),\r\n          },\r\n        },\r\n        (buttonIndex) => {\r\n            console.log(buttonIndex)\r\n        });\r\n    }\r\n\r\n    render(){\r\n        const {\r\n            login,\r\n            scan\r\n        } = this.props;\r\n        return (\r\n            <Popover \r\n                mask\r\n                overlayClassName=\"fortest\"\r\n                overlayStyle={{ color: 'currentColor' }}\r\n                visible={this.state.visible}\r\n                overlay={[\r\n                (!scan&&<Item key=\"4\" value=\"scan\" icon={myImg('tOtXhkIWzwotgGSeptou')} data-seed=\"logId\">扫一扫</Item>),\r\n                (<Item key=\"5\" value=\"photo\" icon={myImg('PKAgAqZWJVNwKsAJSmXd')} style={{ whiteSpace: 'nowrap' }}>拍照</Item>),\r\n                (!login&&<Item key=\"6\" value=\"login\" icon={myImg('uQIYTFeRrjPELImDRrPt')}>\r\n                    <span style={{ marginRight: 5 }}>登录</span>\r\n                </Item>),\r\n                ]}\r\n                align={{\r\n                overflow: { adjustY: 0, adjustX: 0 },\r\n                offset: [-10, 0],\r\n                }}\r\n                onVisibleChange={this.handleVisibleChange}\r\n                onSelect={this.onSelect}\r\n            >\r\n                <div style={{\r\n                height: '100%',\r\n                padding: '0 15px',\r\n                marginRight: '-15px',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                }}\r\n                >\r\n                <Icon  type=\"ellipsis\" />\r\n                </div>\r\n            </Popover>\r\n        )\r\n    }\r\n}","\r\n\r\nimport {observable,action,computed,autorun }  from \"mobx\";\r\n\r\nimport {axios} from \"&\"\r\n\r\nclass ShopCar{\r\n    @observable carList = [];\r\n    \r\n\r\n\r\n    @action getCarList= ()=>{\r\n\r\n        axios.post(\"/react/getShopcarInfo\").then(res=>{\r\n            this.carList = res.data.carList;\r\n        })\r\n    }\r\n\r\n    @action changeOneCheck=(goodId,checked)=>{\r\n        axios.post(\"/react/checkOneAndAll\",{\r\n            goodId,\r\n            checked\r\n        }).then(res=>{\r\n            this.carList = this.carList.map((item)=>{\r\n                if(goodId==item.goodId){\r\n                    item.checked = checked;\r\n                }\r\n                return item;\r\n            })\r\n        })\r\n        \r\n    }\r\n\r\n    @action changeAllCheck=(checked)=>{\r\n        axios.post(\"/react/checkOneAndAll\",{\r\n            checked\r\n        }).then(res=>{\r\n            this.carList = this.carList.map((item)=>{\r\n                item.checked = checked;\r\n                return item;\r\n            })\r\n        })\r\n    }\r\n\r\n    @action changeOneCount = (goodId,flag)=>{\r\n\r\n        axios.post(\"/react/changecount\",{\r\n            goodId,\r\n            flag\r\n        }).then(res=>{\r\n\r\n        })\r\n        this.carList = this.carList.map(item=>{\r\n            if(item.goodId==goodId){\r\n                item.count += flag ? 1:-1;\r\n            }\r\n            return item;\r\n        })\r\n    }\r\n\r\n    @action changeCountByInp = (goodId,count)=>{\r\n        axios.post(\"/react/changecount\",{\r\n            goodId,\r\n            count\r\n        }).then(res=>{\r\n            \r\n        })\r\n        this.carList = this.carList.map(item=>{\r\n            if(item.goodId==goodId){\r\n                item.count  = parseInt(count);\r\n            }\r\n            return item;\r\n        })\r\n    }\r\n\r\n    @action delChecked = ()=>{\r\n        // checked \r\n        var goodIdList = [];\r\n        this.carList.forEach((item)=>{\r\n            if(item.checked){\r\n                goodIdList.push(item.goodId);\r\n            }\r\n        });\r\n        console.log(goodIdList);\r\n        axios.post(\"/react/delSelect\",{\r\n            goodIdList\r\n        }).then(res=>{\r\n            this.carList =  this.carList.filter(item=>!item.checked);\r\n        })\r\n    }\r\n\r\n    @computed get carNum(){\r\n        var num = 0;\r\n        this.carList.forEach((item)=>{\r\n            num+=item.count*1;\r\n        })\r\n        return num;\r\n    }\r\n\r\n    @computed get checkNum(){\r\n        var num = 0;\r\n        this.carList.forEach((item)=>{\r\n            if(item.checked){\r\n                num+=item.count*1;\r\n            }\r\n        })\r\n        return num;\r\n    }\r\n\r\n    @computed get total(){\r\n        var total = 0;\r\n        this.carList.forEach((item)=>{\r\n            if(item.checked){\r\n                total += item.count * item.goodInfo.price * 1;\r\n            }\r\n            \r\n        })\r\n        return total;\r\n    }\r\n\r\n    @computed get quan(){\r\n        var flag = true;   \r\n        this.carList.forEach((item)=>{\r\n            if(!item.checked){\r\n                flag = false;\r\n            }\r\n        })\r\n        return flag;\r\n    }\r\n\r\n\r\n}\r\n\r\nexport default new ShopCar();\r\n\r\n\r\n\r\n"],"sourceRoot":""}