{"version":3,"sources":["scripts/views/login/index.js","scripts/components/Head/index.js","scripts/mobx/users.js"],"names":["mobileReg","codeReg","timer","num","Mine","connect","setMobile","val","code","state","value","setState","phoneFlag","test","loginFlag","setCode","mobile","receiveCode","setInterval","txt","toggle","clearInterval","axios","post","then","res","gotoLogin","data","type","history","push","sessionStorage","token","props","dispatch","changeUserInfo","users","isLogin","this","className","title","show","login","placeholder","clear","ref","el","onChange","disabled","onClick","inline","size","Component","Item","Head","goback","changeTab","localStorage","oldTab","go","gotoSearch","search","scan","mode","icon","onLeftClick","rightContent","key","style","marginRight","Pop","myImg","src","alt","handleVisibleChange","visible","onSelect","obj","console","log","showActionSheet","BUTTONS","showActionSheetWithOptions","options","cancelButtonIndex","length","destructiveButtonIndex","message","maskClosable","wrapProps","onTouchStart","e","preventDefault","buttonIndex","mask","overlayClassName","overlayStyle","color","overlay","data-seed","whiteSpace","align","overflow","adjustY","adjustX","offset","onVisibleChange","height","padding","display","alignItems","User","observable","action","userInfo"],"mappings":"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","file":"static/js/22.be94366d.chunk.js","sourcesContent":["import \"./index.scss\"\r\nimport Head  from \"~/components/Head\"\r\nimport {WingBlank,WhiteSpace,List,InputItem,Button} from \"antd-mobile\";\r\nexport const mobileReg = /^1(3|5|7|8|9)\\d{9}$/\r\nexport const codeReg = /^\\d{4}$/;\r\nlet timer = null;\r\n\r\nexport const num = 60;\r\n\r\nimport {axios} from \"&\"\r\nimport {history} from \"&/history\"\r\n\r\nimport {connect} from \"react-redux\"\r\nimport { changeUserInfo } from \"../../actions\";\r\nimport users from \"~/mobx/users\"\r\n@connect()\r\nexport default class Mine extends Component{\r\n    constructor(){\r\n        super();\r\n        this.state = {\r\n            phoneFlag:false,\r\n            loginFlag:false,\r\n            txt:\"获取验证码\",\r\n            num,\r\n            toggle:true\r\n        }\r\n\r\n    }\r\n    setMobile=(val)=>{\r\n        const code = this.code.state.value;\r\n        this.setState({\r\n            phoneFlag:mobileReg.test(val),\r\n            loginFlag:mobileReg.test(val)&&codeReg.test(code)\r\n        });\r\n    }\r\n    setCode=(val)=>{\r\n        this.setState({\r\n            loginFlag:mobileReg.test(this.mobile.state.value)&&codeReg.test(val)\r\n        })\r\n    }\r\n    receiveCode=()=>{\r\n        timer = setInterval(()=>{\r\n            if(this.state.num>0){\r\n                this.state.num--;\r\n                this.setState({\r\n                    num:this.state.num,\r\n                    txt:\"还剩 \" + this.state.num + \" S\",\r\n                    phoneFlag:false,\r\n                    toggle:false\r\n                })\r\n            }else{\r\n                this.setState({\r\n                    num,\r\n                    txt:\"获取验证码\",\r\n                    phoneFlag:true,\r\n                    toggle:true\r\n                })\r\n                clearInterval(timer);\r\n            }\r\n        },1000);\r\n\r\n\r\n        axios.post(\"/react/sendCode\",{\r\n            mobile:this.mobile.state.value,\r\n        }).then(res=>{\r\n            \r\n        })\r\n    }\r\n    \r\n    gotoLogin=()=>{\r\n        axios.post(\"/react/checkCode\",{\r\n            mobile:this.mobile.state.value,\r\n            code:this.code.state.value\r\n        }).then(res=>{\r\n            if(!!res.data.type){\r\n                history.push(\"/index/mine\");\r\n                sessionStorage.token = res.data.token;\r\n                this.props.dispatch(changeUserInfo({\r\n                    token:res.data.token,\r\n                    mobile:this.mobile.state.value\r\n                }))\r\n                users.changeUserInfo({\r\n                    token:res.data.token,\r\n                    mobile:this.mobile.state.value,\r\n                    isLogin:true\r\n                })\r\n            }else{\r\n                sessionStorage.token = \"\";\r\n            }\r\n        })\r\n    }\r\n\r\n\r\n    render(){\r\n        const {\r\n            phoneFlag,\r\n            loginFlag,\r\n            txt,\r\n            toggle\r\n        }  = this.state;\r\n\r\n        return (\r\n            <div className=\"indexview\">\r\n                <Head title=\"登录、注册\" show={true} login={true}></Head>\r\n                <WingBlank>\r\n                    <WhiteSpace/>\r\n                    <List>\r\n                        <WhiteSpace/>\r\n                        <InputItem\r\n                            type=\"tel\"\r\n                            placeholder=\"请输入手机号码\"\r\n                            clear\r\n                            ref={el=>this.mobile=el}\r\n                            onChange={this.setMobile}\r\n                            disabled={!toggle}\r\n                        >\r\n                        手机号码\r\n                        </InputItem>\r\n                        <WhiteSpace/>\r\n                        <InputItem\r\n                            type=\"number\"\r\n                            placeholder=\"请输入验证码\"\r\n                            clear\r\n                            ref={el=>this.code=el}\r\n                            onChange={this.setCode}\r\n                        >\r\n                        验证码\r\n                        </InputItem>\r\n                        <Button onClick={this.receiveCode} disabled={!phoneFlag} className=\"l-btn\" inline size=\"large\" type=\"warning\"> {txt} </Button>\r\n                        <WhiteSpace/>\r\n                    </List>\r\n                    <Button onClick={this.gotoLogin} disabled={!loginFlag} type=\"primary\" >登录</Button>\r\n                </WingBlank>\r\n            </div>\r\n        )\r\n    }\r\n}","\r\n\r\nimport \"./index.scss\"\r\n\r\nimport {NavBar,Icon,Popover,ActionSheet} from \"antd-mobile\"\r\nconst Item = Popover.Item;\r\n\r\nimport {history} from \"&/history\";\r\n\r\nimport {bus} from \"&\"\r\n\r\nimport {connect} from \"react-redux\"\r\nimport { changeTab } from \"../../actions\";\r\n\r\n\r\n@connect()\r\nexport default class Head extends Component{\r\n    goback=(show)=>{\r\n        if(show){\r\n            // bus.emit(\"changeTab\",localStorage.oldTab);\r\n            this.props.dispatch(changeTab(localStorage.oldTab))\r\n            history.go(-1);\r\n        }\r\n    }\r\n\r\n    gotoSearch=()=>{\r\n        history.push(\"/search\");\r\n    }\r\n\r\n    render(){\r\n        const {\r\n            show,\r\n            search,\r\n            login,\r\n            scan\r\n        }  = this.props;\r\n        return (\r\n            <NavBar\r\n            mode=\"dark\"\r\n            icon={show&&<Icon type=\"left\" />}\r\n            onLeftClick={ ()=>this.goback(show) }\r\n            rightContent={[\r\n             !search&&<Icon key=\"0\" onClick={this.gotoSearch} type=\"search\" style={{ marginRight: '16px' }} />,\r\n             <Pop key={1} login={login} scan={scan}/>     ,\r\n            ]}\r\n          > {this.props.title }</NavBar>\r\n        )\r\n    }\r\n}\r\n\r\nconst myImg = src => <img src={`https://gw.alipayobjects.com/zos/rmsportal/${src}.svg`} className=\"am-icon am-icon-xs\" alt=\"\" />;\r\nclass Pop extends Component{\r\n    constructor(){\r\n        super();\r\n        this.state = {\r\n            visible:false\r\n        }\r\n    }\r\n    handleVisibleChange=(visible)=>{\r\n        this.setState({\r\n            visible\r\n        })\r\n    }\r\n    onSelect=(obj)=>{\r\n        this.setState({\r\n            visible:false\r\n        });\r\n        console.log(obj);\r\n        const value = obj.props.value;\r\n        if(value==\"scan\"){\r\n            history.push(\"/scan\");\r\n        }else if (value==\"login\"){\r\n            history.push(\"/login\");\r\n        }else {\r\n            this.showActionSheet();\r\n        }\r\n    }\r\n\r\n    showActionSheet = () => {\r\n        const BUTTONS = ['拍摄', '从手机相册选择','删除',\"取消\"];\r\n        ActionSheet.showActionSheetWithOptions({\r\n          options: BUTTONS,\r\n          cancelButtonIndex: BUTTONS.length - 1,\r\n          destructiveButtonIndex: BUTTONS.length - 2,\r\n          // title: 'title',\r\n          message: 'wh1906',\r\n          maskClosable: true,\r\n          'data-seed': 'logId',\r\n          wrapProps:{\r\n            onTouchStart: e => e.preventDefault(),\r\n          },\r\n        },\r\n        (buttonIndex) => {\r\n            console.log(buttonIndex)\r\n        });\r\n    }\r\n\r\n    render(){\r\n        const {\r\n            login,\r\n            scan\r\n        } = this.props;\r\n        return (\r\n            <Popover \r\n                mask\r\n                overlayClassName=\"fortest\"\r\n                overlayStyle={{ color: 'currentColor' }}\r\n                visible={this.state.visible}\r\n                overlay={[\r\n                (!scan&&<Item key=\"4\" value=\"scan\" icon={myImg('tOtXhkIWzwotgGSeptou')} data-seed=\"logId\">扫一扫</Item>),\r\n                (<Item key=\"5\" value=\"photo\" icon={myImg('PKAgAqZWJVNwKsAJSmXd')} style={{ whiteSpace: 'nowrap' }}>拍照</Item>),\r\n                (!login&&<Item key=\"6\" value=\"login\" icon={myImg('uQIYTFeRrjPELImDRrPt')}>\r\n                    <span style={{ marginRight: 5 }}>登录</span>\r\n                </Item>),\r\n                ]}\r\n                align={{\r\n                overflow: { adjustY: 0, adjustX: 0 },\r\n                offset: [-10, 0],\r\n                }}\r\n                onVisibleChange={this.handleVisibleChange}\r\n                onSelect={this.onSelect}\r\n            >\r\n                <div style={{\r\n                height: '100%',\r\n                padding: '0 15px',\r\n                marginRight: '-15px',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                }}\r\n                >\r\n                <Icon  type=\"ellipsis\" />\r\n                </div>\r\n            </Popover>\r\n        )\r\n    }\r\n}","\r\nimport {observable,action,computed,autorun }  from \"mobx\"\r\n\r\nclass User{\r\n    @observable userInfo = {\r\n        isLogin:false\r\n    }\r\n\r\n    @action changeUserInfo=obj=>{\r\n        this.userInfo = {...this.userInfo,...obj};\r\n    }\r\n}\r\n\r\nexport default new User()"],"sourceRoot":""}